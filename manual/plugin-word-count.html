<!doctype html>
<html class="no-js" lang=""><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Plugin: Word Count - Inkdrop</title><meta name="description" content="The Notebook for Hackers"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="shortcut icon" href="//inkdrop-prod.s3.amazonaws.com/site/favicon@2x.png"/><link rel="mask-icon" href="//inkdrop-prod.s3.amazonaws.com/site/favicon.svg" color="rgb(17, 20, 24)"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,400,700|Lato:300,400"/><link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjapanese.css"/><script src="/app.js?1474608008726"></script></head><body><div id="app"><div data-reactid=".23l1om8e9ie" data-react-checksum="385494032"><header class="app--header" data-reactid=".23l1om8e9ie.0"><div class="ui container" data-reactid=".23l1om8e9ie.0.0"><div class="ui grid" data-reactid=".23l1om8e9ie.0.0.0"><div class="row" data-reactid=".23l1om8e9ie.0.0.0.0"><a href="https://inkdrop.info/" class="app--logo" data-reactid=".23l1om8e9ie.0.0.0.0.0"><img src="//inkdrop-prod.s3.amazonaws.com/site/header-logo@2x.png" width="196" height="45" alt="logo" data-reactid=".23l1om8e9ie.0.0.0.0.0.0"/></a><ul class="app--navbar reset-list un-select" data-reactid=".23l1om8e9ie.0.0.0.0.1"><li data-reactid=".23l1om8e9ie.0.0.0.0.1.0"><a href="/" data-reactid=".23l1om8e9ie.0.0.0.0.1.0.0">Docs</a></li><li data-reactid=".23l1om8e9ie.0.0.0.0.1.1"><a href="https://inkdrop.info/login" data-reactid=".23l1om8e9ie.0.0.0.0.1.1.0">Login</a></li></ul></div></div></div></header><div class="ui container main-content" data-reactid=".23l1om8e9ie.1"><div class="ui stackable grid" data-reactid=".23l1om8e9ie.1.0"><div class="four wide column" data-reactid=".23l1om8e9ie.1.0.0"><div data-reactid=".23l1om8e9ie.1.0.0.0"><h3 class="ui header" data-reactid=".23l1om8e9ie.1.0.0.0.0">Using Inkdrop</h3><ul class="article-list" data-reactid=".23l1om8e9ie.1.0.0.0.1"><li data-reactid=".23l1om8e9ie.1.0.0.0.1.0"><a href="/manual/quick-start-guide" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.0.0">Quick start guide</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.1"><a href="/manual/basic-usage" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.1.0">Basic usage</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.2"><a href="/manual/writing-note" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.2.0">Writing note</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.3"><a href="/manual/searching-notes" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.3.0">Searching notes</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.4"><a href="/manual/synchronizing-in-the-cloud" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.4.0">Synchronizing in the cloud</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.5"><a href="/manual/extend-inkdrop-with-plugins" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.5.0">Extend Inkdrop with plugins</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.6"><a href="/manual/recovering-your-password" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.6.0">Recovering your password</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.1.7"><a href="/manual/working-behind-a-corporate-web-proxy" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.1.7.0">Working Behind Web Proxy</a></li></ul><h3 class="ui header" data-reactid=".23l1om8e9ie.1.0.0.0.2">Hacking Inkdrop</h3><ul class="article-list" data-reactid=".23l1om8e9ie.1.0.0.0.3"><li data-reactid=".23l1om8e9ie.1.0.0.0.3.0"><a href="/manual/accessing-data-in-the-cloud" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.0.0">Accessing Data in the Cloud</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.3.1"><a href="/manual/creating-a-theme" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.1.0">Creating a Theme</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.3.2"><a href="/manual/plugin-word-count" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.2.0">Plugin: Word Count</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.3.3"><a href="/manual/flux-architecture" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.3.0">Flux Architecture</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.3.4"><a href="/manual/accessing-the-local-database" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.4.0">Accessing the Local Database</a></li><li data-reactid=".23l1om8e9ie.1.0.0.0.3.5"><a href="/manual/customizing-the-editor" class=" " data-reactid=".23l1om8e9ie.1.0.0.0.3.5.0">Customizing the Editor</a></li></ul></div></div><div class="twelve wide column doc-content" data-reactid=".23l1om8e9ie.1.0.1"><div class="ui breadcrumb" data-reactid=".23l1om8e9ie.1.0.1.0"><a href="/" class="section" data-reactid=".23l1om8e9ie.1.0.1.0.0">Docs</a><i class="right chevron icon divider" data-reactid=".23l1om8e9ie.1.0.1.0.1"></i><a href="/manual/" class="section" data-reactid=".23l1om8e9ie.1.0.1.0.2">Inkdrop Manual</a><i class="right chevron icon divider" data-reactid=".23l1om8e9ie.1.0.1.0.3"></i><div class="active section" data-reactid=".23l1om8e9ie.1.0.1.0.4">Plugin: Word Count</div></div><div class="ui divider" data-reactid=".23l1om8e9ie.1.0.1.1"></div><h1 data-reactid=".23l1om8e9ie.1.0.1.2:0">Plugin: Word Count</h1><div data-reactid=".23l1om8e9ie.1.0.1.2:1"><p>Let&#39;s get started by writing a very simple plugin and looking at some of the tools needed to develop one effectively. We&#39;ll start by writing a plugin that tells you how many words are in the current editor and display it in a small modal window.</p>
<h2><a name="scaffolding-your-plugin" class="anchor" href="#scaffolding-your-plugin"><i class="linkify icon"></i></a>Scaffolding your plugin</h2><p>You can generate code scaffolding by running following command:</p>
<pre><code class="lang-bash">$ ipm init -p wordcount
</code></pre>
<p>You can see that <code>ipm</code> has created about a dozen files that make up the plugin. Let&#39;s take a look at each of them to get an idea of how a plugin is structured, then we can modify them to get our word count functionality.</p>
<p>The basic plugin layout is as follows:</p>
<pre><code>word-counter/
├── keymaps
│   └── wordcount.json
├── lib
│   ├── wordcount-message-dialog.js
│   └── wordcount.js
├── menus
│   └── wordcount.json
├── package.json
└── styles
    └── wordcount.less
</code></pre><p>Not every plugin will have (or need) all of these directories. Let&#39;s see what some of these are so we can start messing with them.</p>
<h3><a name="package-json" class="anchor" href="#package-json"><i class="linkify icon"></i></a>package.json</h3><p>Similar to <a href="https://docs.npmjs.com/getting-started/what-is-npm">Node modules</a>, Inkdrop plugins contain a <code>package.json</code> file in their top-level directory. This file contains metadata about the plugin, such as the path to its &quot;main&quot; module, library dependencies, and manifests specifying the order in which its resources should be loaded.</p>
<p>In addition to some of the regular <a href="https://docs.npmjs.com/files/package.json">Node <code>package.json</code> keys</a> available, Inkdrop <code>package.json</code> files have their own additions.</p>
<ul>
<li><code>main</code>: the path to the JavaScript file that&#39;s the entry point to your package. If this is missing, Inkdrop will default to looking for an <code>index.js</code> or <code>index.coffee</code>.</li>
<li><code>styles</code>: an Array of Strings identifying the order of the style sheets your plugin needs to load. If not specified, style sheets in the <code>styles</code> directory are added alphabetically.</li>
<li><code>keymaps</code>: an Array of Strings identifying the order of the key mappings your plugin needs to load. If not specified, mappings in the <code>keymaps</code> directory are added alphabetically.</li>
<li><code>menus</code>: an Array of Strings identifying the order of the menu mappings your plugin needs to load. If not specified, mappings in the <code>menus</code> directory are added alphabetically.</li>
</ul>
<p>The <code>package.json</code> in the plugin we&#39;ve just generated looks like this currently:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"wordcount"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"./lib/wordcount"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A short description of your package"</span>,
  <span class="hljs-attr">"keywords"</span>: [
  ],
  <span class="hljs-attr">"repository"</span>: <span class="hljs-string">"https://github.com/inkdropapp/wordcount"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>,
  <span class="hljs-attr">"engines"</span>: {
    <span class="hljs-attr">"inkdrop"</span>: <span class="hljs-string">"&gt;=0.9.0 &lt;2.0.0"</span>
  },
  <span class="hljs-attr">"dependencies"</span>: {
  }
}
</code></pre>
<p>One of the first things you should do is ensure that this information is filled out. The name, description, repository URL the project will be at, and the license can all be filled out immediately. The other information we&#39;ll get into more detail on as we go.</p>
<div class="ui warning message">
<strong>Warning</strong>: Do not forget to update the repository URL. The one generated for you is invalid by design and will prevent you from publishing your package until updated.
</div>

<h3><a name="source-code" class="anchor" href="#source-code"><i class="linkify icon"></i></a>Source Code</h3><p>If you want to extend Inkdrop&#39;s behavior, your plugin should contain a single top-level module, which you export from whichever file is indicated by the <code>main</code> key in your <code>package.json</code> file. In the plugin we just generated, the main package file is <code>lib/wordcount.js</code>. The remainder of your code should be placed in the lib directory, and required from your top-level file. If the <code>main</code> key is not in your <code>package.json</code> file, it will look for <code>index.coffee</code> or <code>index.js</code> as the main entry point.</p>
<p>Your plugin&#39;s top-level module is a singleton object that manages the lifecycle of your extensions to Inkdrop. Even if your plugin creates ten different components and appends them to different parts of the DOM, it&#39;s all managed from your top-level object.</p>
<p>Your plugin&#39;s top-level module can implement the following basic methods:</p>
<ul>
<li><code>activate()</code>: This <strong>optional</strong> method is called when your plugin is activated. Use this to do initialization work when your plugin is started (like setting up React Components or binding events).</li>
<li><code>deactivate()</code>: This <strong>optional</strong> method is called when the window is shutting down. If your plugin is watching any files or holding external resources in any other way, release them here. If you&#39;re just subscribing to things on window, you don&#39;t need to worry because that&#39;s getting torn down anyway.</li>
</ul>
<h3><a name="style-sheets" class="anchor" href="#style-sheets"><i class="linkify icon"></i></a>Style Sheets</h3><p>Style sheets for your plugin should be placed in the <code>styles</code> directory. Any style sheets in this directory will be loaded and attached to the DOM when your plugin is activated. Style sheets can be written as CSS or <a href="http://lesscss.org/">Less</a>, but Less is recommended.</p>
<p>Ideally, you won&#39;t need much in the way of styling. Inkdrop&#39;s styles are based on <a href="http://semantic-ui.com/">Semantic UI</a> which provides a standard set of components which define both the colors and UI elements for any plugin that fits into Inkdrop seamlessly. </p>
<p>If you <em>do</em> need special styling, try to keep only structural styles in the plugin style sheets. If you must specify colors and sizing, these should be taken from the pre-defined CSS Variables where you can find at <a href="https://github.com/inkdropapp/inkdrop-ui-theme-template/blob/master/src/definitions/globals/variables.less">variables.less</a> like this:</p>
<pre><code class="lang-less"><span class="hljs-selector-class">.special-button</span><span class="hljs-selector-class">.highlighted</span> {
  <span class="hljs-attribute">background-color</span>: var(--highlight-background);
}
</code></pre>
<p>An optional <code>styles</code> array in your <code>package.json</code> can list the style sheets by name to specify a loading order; otherwise, style sheets are loaded alphabetically.</p>
<h3><a name="keymaps" class="anchor" href="#keymaps"><i class="linkify icon"></i></a>Keymaps</h3><p>You can provide key bindings for commonly used actions for your extension, especially if you&#39;re also adding a new command. In our new plugin, we have a keymap filled in for us already in the <code>keymaps/wordcount.json</code> file:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"body"</span>: {
    <span class="hljs-attr">"ctrl-alt-o"</span>: <span class="hljs-string">"wordcount:toggle"</span>
  }
}
</code></pre>
<p>This means that if you press <code>Alt+Ctrl+O</code>, our package will run the <code>wordcount:toggle</code> command. We&#39;ll look at that code next, but if you want to change the default key mapping, you can do that in this file.</p>
<p>Keymaps are placed in the <code>keymaps</code> subdirectory. By default, all keymaps are loaded in alphabetical order. An optional <code>keymaps</code> array in your <code>package.json</code> can specify which keymaps to load and in what order.</p>
<p>Keybindings are executed by determining which element the keypress occurred on. In the example above, the <code>wordcount:toggle</code> command is executed when pressing <code>Alt+Ctrl+O</code> on the <code>body</code> element. This means the key combination will work anywhere in the application.</p>
<h3><a name="menus" class="anchor" href="#menus"><i class="linkify icon"></i></a>Menus</h3><p>Menus are placed in the <code>menus</code> subdirectory. This defines menu elements like what pops up when you right click a context-menu or would go in the application menu to trigger functionality in your plugin.</p>
<p>By default, all menus are loaded in alphabetical order. An optional <code>menus</code> array in your <code>package.json</code> can specify which menus to load and in what order.</p>
<h3><a name="application-menu" class="anchor" href="#application-menu"><i class="linkify icon"></i></a>Application Menu</h3><p>It&#39;s recommended that you create an application menu item under the <em>Plugins</em> menu for common actions with your plugin that aren&#39;t tied to a specific element. If we look in the <code>menus/wordcount.json</code> file that was generated for us, we&#39;ll see a section that looks like this:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"menu"</span>: [
    {
      <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Plugins"</span>,
      <span class="hljs-attr">"submenu"</span>: [
        {
          <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Word Count"</span>,
          <span class="hljs-attr">"submenu"</span>: [
            {
              <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Toggle"</span>,
              <span class="hljs-attr">"command"</span>: <span class="hljs-string">"wordcount:toggle"</span>
            }
          ]
        }
      ]
    }
  ]
}
</code></pre>
<p>This section puts a &quot;Toggle&quot; menu item under a menu group named &quot;Your Name Word Count&quot; in the &quot;Plugins&quot; menu.</p>
<p><img class="ui image" src="/manual/2-3-plugin-word-count-application-menu.png" title="" alt="Application Menu" /></p>
<p>When you select that menu item, it will run the <code>wordcount:toggle</code> command, which we&#39;ll look at in a bit.</p>
<p>The menu templates you specify are merged with all other templates provided by other plugins in the order which they were loaded.</p>
<h3><a name="context-menu" class="anchor" href="#context-menu"><i class="linkify icon"></i></a>Context Menu</h3><p>It&#39;s recommended to specify a context menu item for commands that are linked to specific parts of the interface. In our <code>menus/wordcount.json</code> file, we can see an auto-generated section that looks like this:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"context-menu"</span>: {
    <span class="hljs-attr">".CodeMirror"</span>: [
      {
        <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Toggle Word Count"</span>,
        <span class="hljs-attr">"command"</span>: <span class="hljs-string">"empty:toggle"</span>
      }
    ]
  }
}
</code></pre>
<p>This adds a &quot;Toggle Word Count&quot; menu option to the menu that pops up when you right-click in an Inkdrop text editor pane.</p>
<p><img class="ui image" src="/manual/2-3-plugin-word-count-context-menu.png" title="" alt="Context Menu" /></p>
<p>When you click that it will again run the <code>wordcount:toggle</code> method in your code.</p>
<p>Context menus are created by determining which element was selected and then adding all of the menu items whose selectors match that element (in the order which they were loaded). The process is then repeated for the elements until reaching the top of the DOM tree.</p>
<p>You can also add separators and submenus to your context menus. To add a submenu, provide a <code>submenu</code> key instead of a command. To add a separator, add an item with a single <code>type: &#39;separator&#39;</code> key/value pair. For instance, you could do something like this:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"context-menu"</span>: {
    <span class="hljs-attr">"body"</span>: [
      {
        <span class="hljs-attr">"label"</span>: 'Text'
        <span class="hljs-string">"submenu"</span>: [
          {<span class="hljs-attr">"label"</span>: 'Copy Selected Text', <span class="hljs-attr">"command"</span>: 'core:copy'}
          {<span class="hljs-attr">"type"</span>: 'separator'}
          {<span class="hljs-attr">"label"</span>: 'Selector All', <span class="hljs-attr">"command"</span>: 'core:select-all'}
          {<span class="hljs-attr">"type"</span>: 'separator'}
          {<span class="hljs-attr">"label"</span>: 'Undo', <span class="hljs-attr">"command"</span>: 'core:undo'}
        ]
      }
    ]
  }
}
</code></pre>
<h2><a name="developing-our-plugin" class="anchor" href="#developing-our-plugin"><i class="linkify icon"></i></a>Developing Our Plugin</h2><p>Currently with the generated package we have, if we run that <code>wordcount:toggle</code> command through the menu or the command palette, we&#39;ll get a dialog that says &quot;Word Count was toggled!&quot;.</p>
<p><img class="ui image" src="/manual/2-3-plugin-word-count-dialog.png" title="" alt="Dialog" /></p>
<h3><a name="understanding-the-generated-code" class="anchor" href="#understanding-the-generated-code"><i class="linkify icon"></i></a>Understanding the Generated Code</h3><p>Let&#39;s take a look at the code in our <code>lib</code> directory and see what is happening.</p>
<p>There are two files in our lib directory. One is the main file (<code>lib/wordcount.js</code>), which is pointed to in the <code>package.json</code> file as the main file to execute for this plugin. This file handles the logic of the whole plugin.</p>
<p>The second file is a React Component class, <code>lib/wordcount-message-dialog.js</code>, which handles the UI elements of the plugin. Let&#39;s look at this file first:</p>
<pre><code class="lang-jsx"><span class="hljs-string">'use babel'</span>;

<span class="hljs-keyword">import</span> { React } <span class="hljs-keyword">from</span> <span class="hljs-string">'inkdrop'</span>;
<span class="hljs-keyword">import</span> { CompositeDisposable } <span class="hljs-keyword">from</span> <span class="hljs-string">'inkdrop'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordcountMessageDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{

  componentWillMount () {
    <span class="hljs-comment">// Events subscribed to in Inkdrop's system can be easily cleaned up with a CompositeDisposable</span>
    <span class="hljs-keyword">this</span>.subscriptions = <span class="hljs-keyword">new</span> CompositeDisposable();

    <span class="hljs-comment">// Register command that toggles this view</span>
    <span class="hljs-keyword">this</span>.subscriptions.add(inkdrop.commands.add(<span class="hljs-built_in">document</span>.body, {
      <span class="hljs-string">'wordcount:toggle'</span>: () =&gt; <span class="hljs-keyword">this</span>.toggle()
    }));
  }

  componentWillUnmount () {
    <span class="hljs-keyword">this</span>.subscriptions.dispose();
  }

  render() {
    <span class="hljs-keyword">const</span> { MessageDialog } = inkdrop.components.classes;
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageDialog</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">'dialog'</span> <span class="hljs-attr">title</span>=<span class="hljs-string">'Word Count'</span>&gt;</span>
        Word Count was toggled!
      <span class="hljs-tag">&lt;/<span class="hljs-name">MessageDialog</span>&gt;</span></span>
    );
  }

  toggle() {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Wordcount was toggled!'</span>);
    <span class="hljs-keyword">const</span> { dialog } = <span class="hljs-keyword">this</span>.refs;
    <span class="hljs-keyword">if</span> (!dialog.isShown) {
      dialog.showDialog();
    } <span class="hljs-keyword">else</span> {
      dialog.dismissDialog();
    }
  }
}
</code></pre>
<p>Inkdrop is built with <a href="https://facebook.github.io/react/">React</a>, and you can make UI components with it.
The <code>WordcountMessageDialog</code> defines a React Component which shows a modal message dialog on toggling from the command.
This component implements following four methods:</p>
<ul>
<li><code>componentWillMount</code> - invoked once, immediately before the initial rendering occurs. See <a href="https://facebook.github.io/react/docs/component-specs.html#mounting-componentwillmount">here</a> for more information.</li>
<li><code>componentWillUnmount</code> - invoked once, immediately before a component is unmounted from the DOM. See <a href="https://facebook.github.io/react/docs/component-specs.html#unmounting-componentwillunmount">here</a> for more information.</li>
<li><code>render</code> - invoked when React renders your component. See <a href="https://facebook.github.io/react/docs/tutorial.html">here</a> for more information.</li>
<li><code>toggle</code> - invoked when <code>wordcount:toggle</code> is dispatched.</li>
</ul>
<p>In the <code>componentWillMount</code> method, it creates an instance of the <code>CompositeDisposable</code> class so it can register all the commands that can be called from the plugin so other plugins could subscribe to these events.</p>
<p>The second file we have is the main entry point to the plugin. Again, because it&#39;s referenced in the <code>package.json</code> file. Let&#39;s take a look at that file, it&#39;s pretty simple:</p>
<pre><code class="lang-js"><span class="hljs-string">'use babel'</span>;

<span class="hljs-keyword">import</span> WordcountMessageDialog <span class="hljs-keyword">from</span> <span class="hljs-string">'./wordcount-message-dialog'</span>;

<span class="hljs-built_in">module</span>.exports = {

  activate() {
    inkdrop.components.registerClass(WordcountMessageDialog);
    inkdrop.layouts.addComponentToLayout(<span class="hljs-string">'modals'</span>, <span class="hljs-string">'WordcountMessageDialog'</span>);
  },

  deactivate() {
    inkdrop.layouts.removeComponentFromLayout(<span class="hljs-string">'modals'</span>, <span class="hljs-string">'WordcountMessageDialog'</span>);
    inkdrop.components.deleteClass(WordcountMessageDialog);
  }

};
</code></pre>
<p>In the <code>activate</code> method called on activation of the plugin, it registers the <code>WordcountMessageDialog</code> class to a Inkdrop component registry and adds it to a hidden modal collection.</p>
<h3><a name="the-flow" class="anchor" href="#the-flow"><i class="linkify icon"></i></a>The Flow</h3><p>So, let&#39;s review the actual flow in this plugin.</p>
<ol>
<li>Inkdrop starts up</li>
<li>Inkdrop starts loading plugins</li>
<li>Inkdrop reads your <code>package.json</code></li>
<li>Inkdrop loads keymaps, menus, styles and the main module</li>
<li>Inkdrop finishes loading plugins</li>
<li>Inkdrop executes the <code>activate</code> method in your main module which sets up the UI by creating the hidden modal message dialog</li>
<li>Inkdrop executes the plugin command <code>wordcount:toggle</code> which reveals the hidden modal message dialog</li>
<li>At some point, the user executes the <code>wordcount:toggle</code> command again</li>
<li>Inkdrop executes the command which hides the modal message dialog</li>
</ol>
<h2><a name="counting-the-words" class="anchor" href="#counting-the-words"><i class="linkify icon"></i></a>Counting the Words</h2><p>So now that we understand what is happening, let&#39;s modify the code so that our little modal message dialog shows us the current word count instead of static text.</p>
<p>We&#39;ll do this in a very simple way. When the dialog is toggled, we&#39;ll count the words right before displaying the modal. So let&#39;s do this in the <code>toggle</code> command. If we add some code to count the words and ask the React component to update itself, we&#39;ll have something like this in <code>lib/wordcount-message-dialog.js</code>:</p>
<pre><code class="lang-js">  componentWillMount () {
    <span class="hljs-comment">/* ... */</span>

    <span class="hljs-keyword">this</span>.setState({ words: <span class="hljs-number">0</span> });
  }
</code></pre>
<pre><code class="lang-js">  toggle() {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'WordCount was toggled!'</span>);
    <span class="hljs-keyword">const</span> { dialog } = <span class="hljs-keyword">this</span>.refs;
    <span class="hljs-keyword">if</span> (!dialog.isShown) {
      <span class="hljs-keyword">const</span> editorState = inkdrop.flux.getStore(<span class="hljs-string">'editor'</span>).getState();
      <span class="hljs-keyword">const</span> words = editorState.document.body.split(<span class="hljs-regexp">/\s+/</span>).length;
      <span class="hljs-keyword">this</span>.setState({ words });
      dialog.showDialog();
    } <span class="hljs-keyword">else</span> {
      dialog.dismissDialog();
    }
  }
</code></pre>
<p>Let&#39;s look at the 4 lines we&#39;ve added.
First we set a <code>words</code> to <code>0</code> by calling <code>setState</code> method.
Second we get a state of the <a href="/reference/editor-store">editor store</a> by calling <code>inkdrop.flux.getStore(&#39;editor&#39;).getState()</code>.</p>
<p>Next we get the number of words by looking into <code>editorState.document.body</code>, then splitting that text on whitespace with a regular expression and then getting the length of that array.</p>
<p>Finally, we tell our message dialog to update the word count it displays by calling the <code>setState()</code> method on our dialog and then showing the modal again. Let&#39;s add a code to display the word count through the <code>render</code> method of our <code>lib/wordcount-message-dialog.js</code> file:</p>
<pre><code class="lang-js">  render() {
    <span class="hljs-keyword">const</span> { MessageDialog } = inkdrop.components.classes;
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MessageDialog</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">'dialog'</span> <span class="hljs-attr">title</span>=<span class="hljs-string">'Word Count'</span>&gt;</span>
        There are { this.state.words } words.
      <span class="hljs-tag">&lt;/<span class="hljs-name">MessageDialog</span>&gt;</span></span>
    );
  }
</code></pre>
<p>Pretty simple! We take the count number that was passed in and place it into a string that we then stick into the element that our component is controlling.</p>
<p><img class="ui image" src="/manual/2-3-plugin-word-count-display-count.png" title="" alt="Word count" /></p>
<h2><a name="basic-debugging" class="anchor" href="#basic-debugging"><i class="linkify icon"></i></a>Basic Debugging</h2><p>You&#39;ll notice a few <code>console.log</code> statements in the code. One of the cool things about Inkdrop being built on Chromium is that you can use some of the same debugging tools available to you that you have when doing web development.</p>
<p>To open up the Developer Console, press <code>Alt+Cmd+I</code>, or choose the menu option <em>Developer &gt; Toggle Developer Tools</em>.</p>
<p><img class="ui image" src="/manual/2-2-create-new-theme-devtools.png" title="" alt="Application Menu" /></p>
<p>From here you can inspect objects, run code and view console output just as though you were debugging a web site.</p>
<h2><a name="publishing" class="anchor" href="#publishing"><i class="linkify icon"></i></a>Publishing</h2><p>Now that our simple plugin is working and tested, let&#39;s go ahead and publish it so it&#39;s available to the world.</p>
<p>Inkdrop bundles a command line utility called <code>ipm</code> which we first used back in <a href="/manual/extend-inkdrop-with-plugins#using-ipm-inkdrop-plugin-manager-">Using ipm (Inkdrop Plugin Manager)</a> to search for and install plugins via the command line. The <code>ipm</code> command can also be used to publish Inkdrop plugins to the public registry and update them.</p>
<h3><a name="prepare-your-package" class="anchor" href="#prepare-your-package"><i class="linkify icon"></i></a>Prepare Your Package</h3><p>There are a few things you should double check before publishing:</p>
<ul>
<li>Your <code>package.json</code> file has <code>name</code>, <code>description</code>, and <code>repository</code> fields.</li>
<li>Your <code>package.json</code> file has a <code>version</code> field with a value of &quot;0.0.0&quot;.</li>
<li>Your <code>package.json</code> file has an <code>engines</code> field that contains an entry for Inkdrop such as: <code>&quot;engines&quot;: {&quot;inkdrop&quot;: &quot;&gt;=0.9.0 &lt;2.0.0&quot;}</code>.</li>
<li>Your plugin has a <code>README.md</code> file at the root.</li>
<li>Change the repository url in the <code>package.json</code> file to match the URL of your repository.</li>
<li>Your plugin is in a Git repository that has been pushed to <a href="https://github.com/">GitHub</a>. Follow <a href="http://guides.github.com/overviews/desktop">this guide</a> if your plugin isn&#39;t already on GitHub.</li>
</ul>
<h3><a name="publish-your-package" class="anchor" href="#publish-your-package"><i class="linkify icon"></i></a>Publish Your Package</h3><p>Before you publish a plugin it is a good idea to check ahead of time if a plugin with the same name has already been published to the <a href="https://www.inkdrop.info/plugins">Inkdrop package registry</a>.
You can do that by visiting <a href="https://www.inkdrop.info/plugin/wordcount">https://www.inkdrop.info/plugin/wordcount</a> to see if the plugin already exists. 
If it does, update your plugin&#39;s name to something that is available before proceeding.</p>
<p>Now let&#39;s review what the <code>ipm publish</code> command does:</p>
<ol>
<li>Registers the plugin name on www.inkdrop.info if it is being published for the first time.</li>
<li>Updates the <code>version</code> field in the <code>package.json</code> file and commits it.</li>
<li>Creates a new <a href="http://git-scm.com/book/en/Git-Basics-Tagging">Git tag</a> for the version being published.</li>
<li>Pushes the tag and current branch up to GitHub.</li>
<li>Updates www.inkdrop.info with the new version being published.</li>
</ol>
<p>Now run the following commands to publish your package:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ~/github/my-package
ipm publish minor
</code></pre>
<p>If this is the first package you are publishing, the <code>ipm publish</code> command may prompt you for your Inkdrop API Keys which can be created <a href="https://www.inkdrop.info/account/api-keys">here</a> on the Inkdrop website. This is required to publish and you only need to enter this information the first time you publish. The credentials are stored securely in your <a href="https://en.wikipedia.org/wiki/Keychain_(Apple">keychain</a>) once you login.</p>
<p>Your package is now published and available on www.inkdrop.info. Head on over to <a href="https://www.inkdrop.info/plugins/wordcount">https://www.inkdrop.info/plugins/wordcount</a> to see your plugin&#39;s page.</p>
<p>With <code>ipm publish</code>, you can bump the version and publish by using</p>
<pre><code>$ ipm publish &lt;version-type&gt;
</code></pre><p>where <code>&lt;version-type&gt;</code> can be <code>major</code>, <code>minor</code> and <code>patch</code>.</p>
<p>The <code>major</code> option to the publish command tells ipm to increment the first number of the version before publishing so the published version will be <code>1.0.0</code> and the Git tag created will be <code>v1.0.0</code>.</p>
<p>The <code>minor</code> option to the publish command tells ipm to increment the second number of the version before publishing so the published version will be <code>0.1.0</code> and the Git tag created will be <code>v0.1.0</code>.</p>
<p>The <code>patch</code> option to the publish command tells ipm to increment the third number of the version before publishing so the published version will be <code>0.0.1</code> and the Git tag created will be <code>v0.0.1</code>.</p>
<p>Use <code>major</code> when you make a change that breaks backwards compatibility, like changing defaults or removing features. Use <code>minor</code> when adding new functionality or making improvements on existing code. Use <code>patch</code> when you fix a bug that was causing incorrect behaviour. Check out <a href="http://semver.org/">semantic versioning</a> to learn more about best practices for versioning your plugin releases.</p>
<p>You can also run <code>ipm help publish</code> to see all the available options and <code>ipm help</code> to see all the other available commands.</p>
<h2><a name="summary" class="anchor" href="#summary"><i class="linkify icon"></i></a>Summary</h2><p>We&#39;ve now generated, customized and published our first plugin for Inkdrop. Congratulations! Now anyone can install our masterpiece from directly within Inkdrop as we did in <a href="/manual/extend-inkdrop-with-plugins">Extend Inkdrop with Plugins</a>.</p>
</div><div data-reactid=".23l1om8e9ie.1.0.1.3"><h2 data-reactid=".23l1om8e9ie.1.0.1.3.0">Can you help us improve these docs?</h2><p data-reactid=".23l1om8e9ie.1.0.1.3.1"><span data-reactid=".23l1om8e9ie.1.0.1.3.1.0">The source of these docs is </span><a href="https://github.com/inkdropapp/docs" data-reactid=".23l1om8e9ie.1.0.1.3.1.1">here</a><span data-reactid=".23l1om8e9ie.1.0.1.3.1.2"> on GitHub. If you see a way these docs can be improved, please fork us!</span></p></div></div></div></div><footer class="app--footer" data-reactid=".23l1om8e9ie.2"><div class="app--footer-content ui container" data-reactid=".23l1om8e9ie.2.0"><div class="ui stackable grid" data-reactid=".23l1om8e9ie.2.0.0"><div class="thirteen wide column links" data-reactid=".23l1om8e9ie.2.0.0.0"><ul class="links" data-reactid=".23l1om8e9ie.2.0.0.0.0"><li data-reactid=".23l1om8e9ie.2.0.0.0.0.0"><a href="/terms" data-reactid=".23l1om8e9ie.2.0.0.0.0.0.0">Terms of Use</a></li><li data-reactid=".23l1om8e9ie.2.0.0.0.0.1"><a href="/privacy" data-reactid=".23l1om8e9ie.2.0.0.0.0.1.0">Privacy Policy</a></li><li data-reactid=".23l1om8e9ie.2.0.0.0.0.2"><a href="/faq" data-reactid=".23l1om8e9ie.2.0.0.0.0.2.0">FAQ</a></li><li data-reactid=".23l1om8e9ie.2.0.0.0.0.3"><a href="mailto:inkdrop@pkpk.info" data-reactid=".23l1om8e9ie.2.0.0.0.0.3.0">Contact</a></li><li data-reactid=".23l1om8e9ie.2.0.0.0.0.4"><a href="https://twitter.com/inkdrop_app" target="_blank" data-reactid=".23l1om8e9ie.2.0.0.0.0.4.0">Twitter</a></li><li data-reactid=".23l1om8e9ie.2.0.0.0.0.5"><a href="https://medium.com/@inkdrop" target="_blank" data-reactid=".23l1om8e9ie.2.0.0.0.0.5.0">Blog</a></li></ul></div><div class="three wide column text-left" data-reactid=".23l1om8e9ie.2.0.0.1"><a href="http://odoruinu.net/" target="_blank" data-reactid=".23l1om8e9ie.2.0.0.1.0">© Takuya Matsuyama</a></div></div></div></footer></div></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='https://www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-58709134-3','auto');</script></body></html>
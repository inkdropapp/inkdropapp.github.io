<!doctype html>
<html class="no-js" lang=""><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>CommandRegistry - Inkdrop</title><meta name="description" content="The Notebook for Hackers"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="shortcut icon" href="//inkdrop-prod.s3.amazonaws.com/site/favicon@2x.png"/><link rel="mask-icon" href="//inkdrop-prod.s3.amazonaws.com/site/favicon.svg" color="rgb(17, 20, 24)"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,400,700|Lato:300,400"/><link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjapanese.css"/><script src="/app.js?1476855423097"></script></head><body><div id="app"><div data-reactid=".1gmrhn9x0sg" data-react-checksum="1530730047"><header class="app--header" data-reactid=".1gmrhn9x0sg.0"><div class="ui container" data-reactid=".1gmrhn9x0sg.0.0"><div class="ui grid" data-reactid=".1gmrhn9x0sg.0.0.0"><div class="row" data-reactid=".1gmrhn9x0sg.0.0.0.0"><a href="https://inkdrop.info/" class="app--logo" data-reactid=".1gmrhn9x0sg.0.0.0.0.0"><img src="//inkdrop-prod.s3.amazonaws.com/site/header-logo@2x.png" width="196" height="45" alt="logo" data-reactid=".1gmrhn9x0sg.0.0.0.0.0.0"/></a><ul class="app--navbar reset-list un-select" data-reactid=".1gmrhn9x0sg.0.0.0.0.1"><li data-reactid=".1gmrhn9x0sg.0.0.0.0.1.0"><a href="/" data-reactid=".1gmrhn9x0sg.0.0.0.0.1.0.0">Docs</a></li><li data-reactid=".1gmrhn9x0sg.0.0.0.0.1.1"><a href="https://inkdrop.info/login" data-reactid=".1gmrhn9x0sg.0.0.0.0.1.1.0">Login</a></li></ul></div></div></div></header><div class="ui container main-content" data-reactid=".1gmrhn9x0sg.1"><div class="ui stackable grid" data-reactid=".1gmrhn9x0sg.1.0"><div class="four wide column" data-reactid=".1gmrhn9x0sg.1.0.0"><div data-reactid=".1gmrhn9x0sg.1.0.0.0"><h3 class="ui header" data-reactid=".1gmrhn9x0sg.1.0.0.0.0">Data Models</h3><ul class="article-list" data-reactid=".1gmrhn9x0sg.1.0.0.0.1"><li data-reactid=".1gmrhn9x0sg.1.0.0.0.1.0"><a href="/reference/note" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.1.0.0">Note</a></li><li data-reactid=".1gmrhn9x0sg.1.0.0.0.1.1"><a href="/reference/book" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.1.1.0">Book</a></li><li data-reactid=".1gmrhn9x0sg.1.0.0.0.1.2"><a href="/reference/tag" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.1.2.0">Tag</a></li></ul><h3 class="ui header" data-reactid=".1gmrhn9x0sg.1.0.0.0.2">Flux Stores</h3><ul class="article-list" data-reactid=".1gmrhn9x0sg.1.0.0.0.3"><li data-reactid=".1gmrhn9x0sg.1.0.0.0.3.0"><a href="/reference/editor-store" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.3.0.0">Editor Store</a></li></ul><h3 class="ui header" data-reactid=".1gmrhn9x0sg.1.0.0.0.4">Flux Actions</h3><ul class="article-list" data-reactid=".1gmrhn9x0sg.1.0.0.0.5"><li data-reactid=".1gmrhn9x0sg.1.0.0.0.5.0"><a href="/reference/editor-actions" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.5.0.0">Editor Actions</a></li></ul><h3 class="ui header" data-reactid=".1gmrhn9x0sg.1.0.0.0.6">Essential Classes</h3><ul class="article-list" data-reactid=".1gmrhn9x0sg.1.0.0.0.7"><li data-reactid=".1gmrhn9x0sg.1.0.0.0.7.0"><a href="/reference/environment" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.7.0.0">Environment</a></li><li data-reactid=".1gmrhn9x0sg.1.0.0.0.7.1"><a href="/reference/command-registry" class=" " data-reactid=".1gmrhn9x0sg.1.0.0.0.7.1.0">CommandRegistry</a></li></ul></div></div><div class="twelve wide column doc-content" data-reactid=".1gmrhn9x0sg.1.0.1"><div class="ui breadcrumb" data-reactid=".1gmrhn9x0sg.1.0.1.0"><a href="/" class="section" data-reactid=".1gmrhn9x0sg.1.0.1.0.0">Docs</a><i class="right chevron icon divider" data-reactid=".1gmrhn9x0sg.1.0.1.0.1"></i><a href="/reference/" class="section" data-reactid=".1gmrhn9x0sg.1.0.1.0.2">API Reference</a><i class="right chevron icon divider" data-reactid=".1gmrhn9x0sg.1.0.1.0.3"></i><div class="active section" data-reactid=".1gmrhn9x0sg.1.0.1.0.4">CommandRegistry</div></div><div class="ui divider" data-reactid=".1gmrhn9x0sg.1.0.1.1"></div><h1 data-reactid=".1gmrhn9x0sg.1.0.1.2:0">CommandRegistry</h1><div data-reactid=".1gmrhn9x0sg.1.0.1.2:1"><p>Associates listener functions with commands in a context-sensitive way using DOM node.
You can access a global instance of this class via <code>inkdrop.commands</code>.</p>
<p>The global command registry facilitates a style of event handling known as event delegation. Inkdrop commands are expressed as custom DOM events that can be invoked on the currently focused element via a key binding.
Rather than binding listeners for command events directly to DOM nodes, you instead register command event listeners globally on <code>inkdrop.commands</code> and constrain them to specific kinds of elements with DOM nodes.</p>
<p>Command names must follow the <code>namespace:action</code> pattern, where <code>namespace</code> will typically be the name of your package, and <code>action</code> describes the behavior of your command.
If either part consists of multiple words, these must be separated by hyphens. E.g. <code>awesome-package:turn-it-up-to-eleven</code>.
All words should be lowercased.</p>
<p>As the event bubbles upward through the DOM, all registered event listeners with matching selectors are invoked in order of specificity.
In the event of a specificity tie, the most recently registered listener is invoked first.
This mirrors the &quot;cascade&quot; semantics of CSS.
Event listeners are invoked in the context of the current DOM node, meaning <code>this</code> always points at <code>event.currentTarget</code>.
As is normally the case with DOM events, <code>stopPropagation</code> and <code>stopImmediatePropagation</code> can be used to terminate the bubbling process and prevent invocation of additional listeners.</p>
<h2><a name="example" class="anchor" href="#example"><i class="linkify icon"></i></a>Example</h2><p>Here is a command that inserts the current date in an editor:</p>
<pre><code class="lang-js">inkdrop.commands.add(<span class="hljs-built_in">document</span>.body, {
  <span class="hljs-string">'user:insert-date'</span>: ()=&gt; {
    <span class="hljs-keyword">const</span> { <span class="hljs-built_in">document</span> } = inkdrop.flux.getStore(<span class="hljs-string">'editor'</span>).getState()
    <span class="hljs-built_in">document</span>.body = <span class="hljs-built_in">document</span>.body + <span class="hljs-string">'\n'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleString()
    inkdrop.flux.getActions(<span class="hljs-string">'editor'</span>).update({ <span class="hljs-built_in">document</span>, changed: <span class="hljs-literal">true</span> })
  }
})
</code></pre>
<p>Here is how to invoke the save command:</p>
<pre><code class="lang-js">inkdrop.commands.dispatch(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">'core:save-note'</span>);
</code></pre>
<h2><a name="methods" class="anchor" href="#methods"><i class="linkify icon"></i></a>Methods</h2><h3><a name="add-target-commandname-callback-" class="anchor" href="#add-target-commandname-callback-"><i class="linkify icon"></i></a>add(target, commandName, callback)</h3><p>Add a command listener associated with a DOM node.</p>
<table class="ui table"><thead><tr>
<th style="text-align:left">Argument</th>
<th style="text-align:left">Description</th>
</tr>
</thead><tbody><tr>
<td style="text-align:left"><code>target</code></td>
<td style="text-align:left">A DOM node.</td>
</tr>
<tr>
<td style="text-align:left"><code>commandName</code></td>
<td style="text-align:left">A String containing the name of a command you want to handle such as <code>user:insert-date</code>.</td>
</tr>
<tr>
<td style="text-align:left"><code>callback(event)</code></td>
<td style="text-align:left">A Function to call when the given command is invoked on an element matching the selector. It will be called with this referencing the matching DOM node.</td>
</tr>
</tbody></table><h3><a name="add-target-commands-" class="anchor" href="#add-target-commands-"><i class="linkify icon"></i></a>add(target, commands)</h3><p>Add multiple command listeners associated with a DOM node.</p>
<table class="ui table"><thead><tr>
<th style="text-align:left">Argument</th>
<th style="text-align:left">Description</th>
</tr>
</thead><tbody><tr>
<td style="text-align:left"><code>target</code></td>
<td style="text-align:left">A DOM node.</td>
</tr>
<tr>
<td style="text-align:left"><code>commands</code></td>
<td style="text-align:left">An Object mapping command names like <code>user:insert-date</code> to listener Functions.</td>
</tr>
</tbody></table><h3><a name="dispatch-target-commandname-" class="anchor" href="#dispatch-target-commandname-"><i class="linkify icon"></i></a>dispatch(target, commandName)</h3><p>Simulate the dispatch of a command on a DOM node.</p>
<p>This can be useful for testing when you want to simulate the invocation of a command on a detached DOM node.
Otherwise, the DOM node in question needs to be attached to the document so the event bubbles up to the root node to be processed.</p>
<table class="ui table"><thead><tr>
<th style="text-align:left">Argument</th>
<th style="text-align:left">Description</th>
</tr>
</thead><tbody><tr>
<td style="text-align:left"><code>target</code></td>
<td style="text-align:left">The DOM node at which to start bubbling the command event.</td>
</tr>
<tr>
<td style="text-align:left"><code>commandName</code></td>
<td style="text-align:left">String indicating the name of the command to dispatch.</td>
</tr>
</tbody></table></div><div data-reactid=".1gmrhn9x0sg.1.0.1.3"><h2 data-reactid=".1gmrhn9x0sg.1.0.1.3.0">Can you help us improve these docs?</h2><p data-reactid=".1gmrhn9x0sg.1.0.1.3.1"><span data-reactid=".1gmrhn9x0sg.1.0.1.3.1.0">The source of these docs is </span><a href="https://github.com/inkdropapp/docs" data-reactid=".1gmrhn9x0sg.1.0.1.3.1.1">here</a><span data-reactid=".1gmrhn9x0sg.1.0.1.3.1.2"> on GitHub. If you see a way these docs can be improved, please fork us!</span></p></div></div></div></div><footer class="app--footer" data-reactid=".1gmrhn9x0sg.2"><div class="app--footer-content ui container" data-reactid=".1gmrhn9x0sg.2.0"><div class="ui stackable grid" data-reactid=".1gmrhn9x0sg.2.0.0"><div class="thirteen wide column links" data-reactid=".1gmrhn9x0sg.2.0.0.0"><ul class="links" data-reactid=".1gmrhn9x0sg.2.0.0.0.0"><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.0"><a href="/terms" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.0.0">Terms of Use</a></li><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.1"><a href="/privacy" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.1.0">Privacy Policy</a></li><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.2"><a href="/faq" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.2.0">FAQ</a></li><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.3"><a href="mailto:inkdrop@pkpk.info" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.3.0">Contact</a></li><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.4"><a href="https://twitter.com/inkdrop_app" target="_blank" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.4.0">Twitter</a></li><li data-reactid=".1gmrhn9x0sg.2.0.0.0.0.5"><a href="https://medium.com/@inkdrop" target="_blank" data-reactid=".1gmrhn9x0sg.2.0.0.0.0.5.0">Blog</a></li></ul></div><div class="three wide column text-left" data-reactid=".1gmrhn9x0sg.2.0.0.1"><a href="http://odoruinu.net/" target="_blank" data-reactid=".1gmrhn9x0sg.2.0.0.1.0">Â© Takuya Matsuyama</a></div></div></div></footer></div></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='https://www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-58709134-3','auto');</script></body></html>